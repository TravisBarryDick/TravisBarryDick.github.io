(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var i=s.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&!t;)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},s={};function i(e,t){const s=t.name;if(t.private)throw new Error(`'bound' cannot decorate private properties like ${s}.`);t.addInitializer((function(){this[s]=this[s].bind(this)}))}t.d(s,{wA:()=>n,JH:()=>c,GT:()=>_,YW:()=>d,We:()=>l,zp:()=>a,xT:()=>o,xP:()=>m,Js:()=>i,fy:()=>r});class n{tick(e,t){}on_add(e){}on_remove(e){}}class o{constructor(){this.map=new Map}get size(){return this.map.size}set(e,t){this.map.set(e,t)}get(e){return this.map.get(e)}has(e){return this.map.has(e)}delete(e){return this.map.delete(e)}clear(){this.map.clear()}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}forEach(e){for(let t of this.map.keys())e(t,this.map.get(t))}}function r(e){return Object.getPrototypeOf(e).constructor}class a{constructor(){this.handlers=new Array,this.messages=new Array}enqueue(e){this.messages.push(e)}add_handler(e){this.handlers.push(e)}remove_handler(e){const t=this.handlers.indexOf(e);-1!=t&&this.handlers.splice(t,1)}num_handlers(){return this.handlers.length}handle(){for(let e of this.messages)for(let t of this.handlers)t(e);this.messages.splice(0,this.messages.length)}}class l{constructor(){this.message_queues=new o}dispatch(e){const t=r(e),s=this.message_queues.get(t);void 0!==s&&s.enqueue(e)}add_handler(e,t){var s;this.message_queues.has(e)||this.message_queues.set(e,new a),null===(s=this.message_queues.get(e))||void 0===s||s.add_handler(t)}remove_handler(e,t){let s=this.message_queues.get(e);void 0!==s&&(s.remove_handler(t),0==s.num_handlers()&&this.message_queues.delete(e))}handle(){this.message_queues.forEach(((e,t)=>t.handle()))}}class c{constructor(){this.components=new o,this.message_dispatcher=new l}on_add(e){this.game=e}on_remove(e){this.game=void 0}add_component(e){let t=r(e);this.components.set(t,e),e.entity=this,this.game&&this.game.entity_component_tracker.register(this,t),e.on_add(this)}get_component(e){return this.components.get(e)}get_component_or_die(e){let t=this.get_component(e);if(void 0===t)throw new Error(`Tried to get component ${e.name} from entity that does not have it.`);return t}remove_component(e){let t=this.get_component(e);return t&&(t.entity=void 0,t.on_remove(this)),this.game&&this.game.entity_component_tracker.unregister(this,e),this.components.delete(e)}destroy(){for(let e of this.components.keys())this.remove_component(e)}tick(e,t){this.message_dispatcher.handle(),this.components.forEach(((s,i)=>i.tick(e,t))),this.message_dispatcher.handle()}}function h(e,t){if(e.size>t.size)return h(t,e);let s=new Set;for(let i of e)t.has(i)&&s.add(i);return s}class _{constructor(){this.listeners=new Map,this.component_to_entity=new Map}add_listener(e,t){var s;this.listeners.has(e)||this.listeners.set(e,new Set),null===(s=this.listeners.get(e))||void 0===s||s.add(t)}remove_listener(e,t){var s,i;null===(s=this.listeners.get(e))||void 0===s||s.delete(t),0==(null===(i=this.listeners.get(e))||void 0===i?void 0:i.size)&&this.listeners.delete(e)}register(e,t){var s;this.component_to_entity.has(t)||this.component_to_entity.set(t,new Set),null===(s=this.component_to_entity.get(t))||void 0===s||s.add(e);let i=this.listeners.get(t);if(i)for(let s of i)s("add",t,e)}unregister(e,t){var s;if(!this.component_to_entity.has(t))return;null===(s=this.component_to_entity.get(t))||void 0===s||s.delete(e);let i=this.listeners.get(t);if(i)for(let s of i)s("remove",t,e)}entities_with_component(e){const t=this.component_to_entity.get(e);return void 0===t?new Set:t}all_entities(){return function(...e){let t=new Set;for(let s of e)for(let e of s)t.add(e);return t}(...this.component_to_entity.values())}get_entities(e){if(0==e.length)return this.all_entities();e.sort(((e,t)=>this.entities_with_component(e).size-this.entities_with_component(t).size));let t=this.entities_with_component(e[0]);for(let s of e.slice(1))t=h(t,this.entities_with_component(s));return t}}class d{constructor(){this.entities=new Set,this.entity_component_tracker=new _,this.systems=new o,this.message_dispatcher=new l,this.last_time=void 0}create_entity(){let e=new c;return this.add_entity(e),e}add_entity(e){this.entities.add(e),e.on_add(this)}remove_entity(e){e.on_remove(this),e.destroy(),this.entities.delete(e)}add_system(e){const t=r(e);this.systems.set(t,e),e.game=this,e.on_add(this)}remove_system(e){let t=this.get_system(e);void 0!==t&&(t.on_remove(this),t.game=void 0,this.systems.delete(e))}has_system(e){return this.systems.has(e)}get_system(e){return this.systems.get(e)}get_system_or_die(e){let t=this.get_system(e);if(void 0===t)throw new Error(`Tried to get system ${e.name} from game that does not have it.`);return t}tick(e){void 0===this.last_time&&(this.last_time=e),this.message_dispatcher.handle();const t=e-this.last_time;for(let s of this.entities)s.tick(e,t);this.systems.forEach(((s,i)=>i.tick(e,t))),this.message_dispatcher.handle(),this.last_time=e}}class m{constructor(){this.message_dispatcher=new l}on_add(e){}on_remove(e){}get_entities(e){if(void 0===this.game)throw new Error("System is not attached to game and can not get_entities.");return this.game.entity_component_tracker.get_entities(e)}tick(e,t){this.message_dispatcher.handle()}}var g=s.wA,p=s.YW,u=s.xP,w=s.Js;class f{constructor(e,t){this._x=e,this._y=t}get x(){return this._x}get y(){return this._y}add(e){return new f(this._x+e._x,this._y+e._y)}sub(e){return new f(this._x-e._x,this._y-e._y)}scale(e){return new f(this._x*e,this._y*e)}equals(e){return this.x==e.x&&this.y==e.y}toString(){return`Vec2(${this._x}, ${this._y})`}}function y(e,t){if(t.size<e.size)return y(t,e);let s=new Set;for(const i of e)t.has(i)&&s.add(i);return s}function v(e){for(let t of e)return t;throw new Error("Tried to get an element from an empty set.")}class b{constructor(){this.x_map=new Map,this._size=0}get size(){return this._size}set(e,t){var s;this.has(e)||(this._size+=1),this.x_map.has(e.x)||this.x_map.set(e.x,new Map),null===(s=this.x_map.get(e.x))||void 0===s||s.set(e.y,t)}get(e){var t;return null===(t=this.x_map.get(e.x))||void 0===t?void 0:t.get(e.y)}has(e){return void 0!==this.get(e)}delete(e){var t,s;return!!this.has(e)&&(null===(t=this.x_map.get(e.x))||void 0===t||t.delete(e.y),0==(null===(s=this.x_map.get(e.x))||void 0===s?void 0:s.size)&&this.x_map.delete(e.x),this._size-=1,!0)}}class x extends g{constructor(e){super(),this._pos=e}set pos(e){this._pos=e,this.system&&this.entity&&this.system.set_entity_position(this.entity,this.pos)}get pos(){return this._pos}}let k=(()=>{var e;let t,s=u,i=[];return e=class extends s{constructor(){super(),this.pos_to_entity=void function(e,t,s){for(var i=arguments.length>2,n=0;n<t.length;n++)s=i?t[n].call(e,s):t[n].call(e)}(this,i),this.pos_to_entity=new b,this.entity_to_pos=new Map}on_add(e){e.entity_component_tracker.add_listener(x,this.component_listener)}on_remove(e){e.entity_component_tracker.remove_listener(x,this.component_listener)}component_listener(e,t,s){if("remove"==e){this.remove_entity(s);let e=s.get_component(x);e&&(e.system=void 0)}else{let e=s.get_component(x);if(void 0===e)return;e.system=this,this.set_entity_position(s,e.pos)}}set_entity_position(e,t){var s,i;let n=this.entity_to_pos.get(e);void 0!==n&&(null===(s=this.pos_to_entity.get(n))||void 0===s||s.delete(e)),this.entity_to_pos.set(e,t),this.pos_to_entity.has(t)||this.pos_to_entity.set(t,new Set),null===(i=this.pos_to_entity.get(t))||void 0===i||i.add(e)}remove_entity(e){var t;let s=this.entity_to_pos.get(e);void 0!==s&&(null===(t=this.pos_to_entity.get(s))||void 0===t||t.delete(e)),this.entity_to_pos.delete(e)}entities_at(e,t=void 0){let s=this.pos_to_entity.get(e);return void 0===s&&(s=new Set),void 0!==t&&(s=y(s,this.get_entities(t))),s}position_of(e){return this.entity_to_pos.get(e)}},(()=>{var n;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(n=s[Symbol.metadata])&&void 0!==n?n:null):void 0;t=[w],function(e,t,s,i,n,o){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",h=!t&&e?i.static?e:e.prototype:null,_=t||(h?Object.getOwnPropertyDescriptor(h,i.name):{}),d=!1,m=s.length-1;m>=0;m--){var g={};for(var p in i)g[p]="access"===p?{}:i[p];for(var p in i.access)g.access[p]=i.access[p];g.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(r(e||null))};var u=(0,s[m])("accessor"===l?{get:_.get,set:_.set}:_[c],g);if("accessor"===l){if(void 0===u)continue;if(null===u||"object"!=typeof u)throw new TypeError("Object expected");(a=r(u.get))&&(_.get=a),(a=r(u.set))&&(_.set=a),(a=r(u.init))&&n.unshift(a)}else(a=r(u))&&("field"===l?n.unshift(a):_[c]=a)}h&&Object.defineProperty(h,i.name,_),d=!0}(e,null,t,{kind:"method",name:"component_listener",static:!1,private:!1,access:{has:e=>"component_listener"in e,get:e=>e.component_listener},metadata:o},null,i),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})();class z extends g{constructor(e){super(),this.color_ix=e}}class A extends g{constructor(e=void 0){super(),this.held_color=e}}class E extends g{}let S=(()=>{var e;let t,s=u,i=[];return e=class extends s{constructor(e){super(),this.num_colors=(function(e,t,s){for(var i=arguments.length>2,n=0;n<t.length;n++)s=i?t[n].call(e,s):t[n].call(e)}(this,i),e)}on_add(e){e.message_dispatcher.add_handler(H,this.on_movement_request)}on_remove(e){e.message_dispatcher.remove_handler(H,this.on_movement_request)}get_adjacent_colors(e){let t=new Set;for(let s of e)t.add(s),t.add(0==s?this.num_colors-1:s-1),t.add(s==this.num_colors-1?0:s+1);return t}get_tile_color(e){if(void 0===this.game)throw new Error("Called get_tile_color outside of game.");let t=y(this.game.get_system_or_die(k).entities_at(e),this.get_entities([z]));for(let e of t)return e.get_component_or_die(z).color_ix}get_player_colors(){if(void 0===this.game)throw new Error("Tried to get player colors outside of game.");let e=new Set,t=v(this.get_entities([A,x])),s=t.get_component_or_die(A).held_color;void 0!==s&&e.add(s);let i=t.get_component_or_die(x).pos,n=this.get_tile_color(i);return void 0!==n&&e.add(n),e}can_move_in_dir(e){if(void 0===this.game)return!1;let t=v(this.get_entities([A,x])).get_component_or_die(x).pos,s=t.add(e);return this.can_move(t,s)}can_move(e,t){if(!this.game)return!1;let s=this.game.get_system_or_die(k),i=v(this.get_entities([A])).get_component_or_die(A).held_color,n=s.entities_at(e,[z]),o=s.entities_at(t,[z]);if(0==n.size||0==o.size)return!1;let r=new Set([v(n).get_component_or_die(z).color_ix]);i&&r.add(i);let a=v(o).get_component_or_die(z).color_ix;return this.get_adjacent_colors(r).has(a)}on_movement_request(e){if(this.can_move_in_dir(e.direction)){let t=v(this.get_entities([A,x])).get_component_or_die(x);t.pos=t.pos.add(e.direction)}}},(()=>{var n;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(n=s[Symbol.metadata])&&void 0!==n?n:null):void 0;t=[w],function(e,t,s,i,n,o){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",h=!t&&e?i.static?e:e.prototype:null,_=t||(h?Object.getOwnPropertyDescriptor(h,i.name):{}),d=!1,m=s.length-1;m>=0;m--){var g={};for(var p in i)g[p]="access"===p?{}:i[p];for(var p in i.access)g.access[p]=i.access[p];g.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(r(e||null))};var u=(0,s[m])("accessor"===l?{get:_.get,set:_.set}:_[c],g);if("accessor"===l){if(void 0===u)continue;if(null===u||"object"!=typeof u)throw new TypeError("Object expected");(a=r(u.get))&&(_.get=a),(a=r(u.set))&&(_.set=a),(a=r(u.init))&&n.unshift(a)}else(a=r(u))&&("field"===l?n.unshift(a):_[c]=a)}h&&Object.defineProperty(h,i.name,_),d=!0}(e,null,t,{kind:"method",name:"on_movement_request",static:!1,private:!1,access:{has:e=>"on_movement_request"in e,get:e=>e.on_movement_request},metadata:o},null,i),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})();class j extends g{constructor(e){super(),this.color_ix=e}}let O=(()=>{var e;let t,s=u,i=[];return e=class extends s{on_add(e){e.message_dispatcher.add_handler(R,this.on_pickup_color)}on_remove(e){e.message_dispatcher.remove_handler(R,this.on_pickup_color)}on_pickup_color(e){if(void 0===this.game)return;let t=v(this.get_entities([A])),s=t.get_component_or_die(x).pos,i=this.game.get_system_or_die(k).entities_at(s,[j]),n=t.get_component_or_die(A).held_color;if(void 0!==n){t.get_component_or_die(A).held_color=void 0;let e=this.game.create_entity();e.add_component(new j(n)),e.add_component(new x(s))}if(i.size>0){let e=v(i);t.get_component_or_die(A).held_color=e.get_component_or_die(j).color_ix,e.destroy(),this.game.remove_entity(e)}}constructor(){super(...arguments),function(e,t,s){for(var i=arguments.length>2,n=0;n<t.length;n++)s=i?t[n].call(e,s):t[n].call(e)}(this,i)}},(()=>{var n;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(n=s[Symbol.metadata])&&void 0!==n?n:null):void 0;t=[w],function(e,t,s,i,n,o){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",h=!t&&e?i.static?e:e.prototype:null,_=t||(h?Object.getOwnPropertyDescriptor(h,i.name):{}),d=!1,m=s.length-1;m>=0;m--){var g={};for(var p in i)g[p]="access"===p?{}:i[p];for(var p in i.access)g.access[p]=i.access[p];g.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(r(e||null))};var u=(0,s[m])("accessor"===l?{get:_.get,set:_.set}:_[c],g);if("accessor"===l){if(void 0===u)continue;if(null===u||"object"!=typeof u)throw new TypeError("Object expected");(a=r(u.get))&&(_.get=a),(a=r(u.set))&&(_.set=a),(a=r(u.init))&&n.unshift(a)}else(a=r(u))&&("field"===l?n.unshift(a):_[c]=a)}h&&Object.defineProperty(h,i.name,_),d=!0}(e,null,t,{kind:"method",name:"on_pickup_color",static:!1,private:!1,access:{has:e=>"on_pickup_color"in e,get:e=>e.on_pickup_color},metadata:o},null,i),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})();const P=e.p+"2086bfb7af05b226f9fa.png",T=e.p+"9cf89a82b94fb9bc5b41.png",q=e.p+"ea6260ff38396f7bd3c3.png",I=e.p+"880b629e4fcd2a259c93.png";new f(1,0),new f(-1,0),new f(0,1),new f(0,-1);class B extends u{constructor(e){super(),this.canvas=e.canvas;let t=this.canvas.getContext("2d");if(null===t)throw new Error("Could not create rendering context.");this.ctx=t,this.tile_size=e.tile_size,this.colors=e.colors,this.player=document.createElement("img"),this.player.src=P,this.goal=document.createElement("img"),this.goal.src=T,this.wall=document.createElement("img"),this.wall.src=q,this.one_way_wall=document.createElement("img"),this.one_way_wall.src=I;for(let e of[this.player,this.goal,this.wall,this.one_way_wall])e.onload=()=>this.render()}set_level_size(e){this.level_size=e,this.canvas.width=e.x*this.tile_size,this.canvas.height=e.y*this.tile_size}render(){this.draw_tiles(),this.draw_walls(),this.draw_goal(),this.draw_orbs(),this.draw_player()}draw_player(){for(let e of this.get_entities([A,x])){let t=e.get_component_or_die(x).pos;this.draw_img(this.player,t.add(new f(.5,.5)).scale(this.tile_size));let s=e.get_component_or_die(A).held_color;void 0!==s&&(this.ctx.fillStyle=this.colors[s],this.ctx.beginPath(),this.ctx.ellipse((t.x+.5+.2)*this.tile_size,(t.y+.5+.1)*this.tile_size,.1*this.tile_size,.1*this.tile_size,0,0,360),this.ctx.fill(),this.ctx.strokeStyle="#000",this.ctx.stroke())}}draw_orbs(){for(let e of this.get_entities([j,x])){let t=e.get_component_or_die(x).pos,s=e.get_component_or_die(j).color_ix;this.ctx.fillStyle=this.colors[s],this.ctx.beginPath(),this.ctx.ellipse((t.x+.5)*this.tile_size,(t.y+.5)*this.tile_size,.4*this.tile_size,.4*this.tile_size,0,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#000",this.ctx.stroke()}}draw_goal(){let e=v(this.get_entities([E])).get_component_or_die(x).pos;this.draw_img(this.goal,e.add(new f(.5,.5)).scale(this.tile_size))}draw_tiles(){for(let e of this.get_entities([z,x])){let t=e.get_component_or_die(x).pos,s=e.get_component_or_die(z).color_ix;this.ctx.fillStyle=this.colors[s],this.ctx.fillRect(t.x*this.tile_size,t.y*this.tile_size,this.tile_size,this.tile_size)}}draw_wall(e,t){if(void 0===this.game)return;let s=e,i=e.add("right"==t?new f(1,0):new f(0,1)),n=this.game.get_system_or_die(k),o=this.game.get_system_or_die(S);if(0==n.entities_at(s,[z]).size||0==n.entities_at(i,[z]).size)return;let r=o.can_move(s,i),a=o.can_move(i,s),l="right"==t?e.add(new f(1,.5)).scale(this.tile_size):e.add(new f(.5,1)).scale(this.tile_size);this.ctx.save(),r||a?r&&!a?(this.ctx.translate(l.x,l.y),"down"==t&&this.ctx.rotate(Math.PI/2),this.draw_img(this.one_way_wall,new f(0,0)),this.ctx.restore()):!r&&a&&(this.ctx.translate(l.x,l.y),"down"==t&&this.ctx.rotate(Math.PI/2),this.ctx.scale(-1,1),this.draw_img(this.one_way_wall,new f(0,0)),this.ctx.restore()):(this.ctx.translate(l.x,l.y),"down"==t&&this.ctx.rotate(Math.PI/2),this.draw_img(this.wall,new f(0,0)),this.ctx.restore())}draw_walls(){for(let e of this.get_entities([z,x])){let t=e.get_component_or_die(x).pos;this.draw_wall(t,"right"),this.draw_wall(t,"down")}}draw_img(e,t){this.ctx.drawImage(e,t.x-e.width/2,t.y-e.height/2)}tick(e,t){this.render()}}class M{}class C{}class F{constructor(e,t,s){this.level_str=e,this.start=t,this.end=s,this.message="",this.cb=()=>{},this.orbs=[]}set_message(e){return this.message=e,this}set_cb(e){return this.cb=e,this}add_orb(e,t){return this.orbs.push({pos:e,color_ix:t}),this}create(e){let t=this.level_str.split("\n").map((e=>e.trim())).filter((e=>e.length>0)),s=0,i=0;for(let n of t){let t=0;for(let i of n){if("."!=i){let n=e.create_entity();n.add_component(new z(parseInt(i,12))),n.add_component(new x(new f(t,s)))}t+=1}i=Math.max(i,t),s+=1}let n=t.length;e.get_system_or_die(B).set_level_size(new f(i,n));let o=e.create_entity();o.add_component(new A),o.add_component(new x(this.start));let r=e.create_entity();r.add_component(new E),r.add_component(new x(this.end));for(let t of this.orbs){let s=e.create_entity();s.add_component(new x(t.pos)),s.add_component(new j(t.color_ix))}}}class D extends u{constructor(e,t){super(),this.level_creators=e,this.message_div=t,this.current_level=0}set_level(e){if(void 0===this.game)throw new Error("Tried to set level without game.");for(let e of this.game.entities)e.destroy(),this.game.remove_entity(e);let t=this.level_creators[e];t.create(this.game),this.game.tick((this.game.last_time||0)+1),console.log(t.message),this.message_div.innerHTML=t.message,t.cb()}tick(e,t){if(!this.game)return;let s=v(this.get_entities([A])).get_component_or_die(x).pos,i=v(this.get_entities([E])).get_component_or_die(x).pos;if(s.equals(i)){let e=document.getElementById("win_message");e.style.visibility="visible",document.body.style.backgroundColor="#FEF7BD";let t=this.game;t.message_dispatcher.dispatch(new M),window.setTimeout((()=>{this.set_level(++this.current_level),e.style.visibility="hidden",document.body.style.backgroundColor="#EEE",t.message_dispatcher.dispatch(new C),t.message_dispatcher.handle()}),1500)}}}var $=function(e,t,s,i,n,o){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=i.kind,c="getter"===l?"get":"setter"===l?"set":"value",h=!t&&e?i.static?e:e.prototype:null,_=t||(h?Object.getOwnPropertyDescriptor(h,i.name):{}),d=!1,m=s.length-1;m>=0;m--){var g={};for(var p in i)g[p]="access"===p?{}:i[p];for(var p in i.access)g.access[p]=i.access[p];g.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(r(e||null))};var u=(0,s[m])("accessor"===l?{get:_.get,set:_.set}:_[c],g);if("accessor"===l){if(void 0===u)continue;if(null===u||"object"!=typeof u)throw new TypeError("Object expected");(a=r(u.get))&&(_.get=a),(a=r(u.set))&&(_.set=a),(a=r(u.init))&&n.unshift(a)}else(a=r(u))&&("field"===l?n.unshift(a):_[c]=a)}h&&Object.defineProperty(h,i.name,_),d=!0};const L=new f(0,-1),W=new f(0,1),Y=new f(1,0),J=new f(-1,0);class H{constructor(e){this.direction=e}}class R{}let G=(()=>{var e;let t,s,i,n=u,o=[];return e=class extends n{constructor(){super(),this.enabled=void function(e,t,s){for(var i=arguments.length>2,n=0;n<t.length;n++)s=i?t[n].call(e,s):t[n].call(e)}(this,o),this.enabled=!0}on_add(e){window.addEventListener("keydown",this.on_key_down),e.message_dispatcher.add_handler(M,this.on_transition_start),e.message_dispatcher.add_handler(C,this.on_transition_end)}on_remove(e){window.removeEventListener("keydown",this.on_key_down),e.message_dispatcher.remove_handler(M,this.on_transition_start),e.message_dispatcher.remove_handler(C,this.on_transition_end)}on_transition_start(e){this.enabled=!1}on_transition_end(e){this.enabled=!0}on_key_down(e){if(void 0===this.game)return;if(!this.enabled)return;const t=e.key.toLowerCase();"w"==t&&(this.game.message_dispatcher.dispatch(new H(L)),this.game.tick((this.game.last_time||0)+1)),"s"==t&&(this.game.message_dispatcher.dispatch(new H(W)),this.game.tick((this.game.last_time||0)+1)),"a"==t&&(this.game.message_dispatcher.dispatch(new H(J)),this.game.tick((this.game.last_time||0)+1)),"d"==t&&(this.game.message_dispatcher.dispatch(new H(Y)),this.game.tick((this.game.last_time||0)+1)),"x"==t&&(this.game.message_dispatcher.dispatch(new R),this.game.tick((this.game.last_time||0)+1))}},(()=>{var r;const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(r=n[Symbol.metadata])&&void 0!==r?r:null):void 0;t=[w],s=[w],i=[w],$(e,null,t,{kind:"method",name:"on_transition_start",static:!1,private:!1,access:{has:e=>"on_transition_start"in e,get:e=>e.on_transition_start},metadata:a},null,o),$(e,null,s,{kind:"method",name:"on_transition_end",static:!1,private:!1,access:{has:e=>"on_transition_end"in e,get:e=>e.on_transition_end},metadata:a},null,o),$(e,null,i,{kind:"method",name:"on_key_down",static:!1,private:!1,access:{has:e=>"on_key_down"in e,get:e=>e.on_key_down},metadata:a},null,o),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})})(),e})(),N=new p;const Q=["#FAEB36","#90EE90","#79C314","#008080","#487DE7","#3532B2","#70369D","#F33A6A","#E81416","#FF7336","#FFA500","#FDCB18"];let V=[new F("00000",new f(0,0),new f(4,0)).set_message("Move to the star using WASD."),new F("\n    BBB\n    050\n    111\n  ",new f(0,1),new f(2,1)).set_message("You can only move between adjacent colors on the color wheel.").set_cb((()=>{document.getElementById("color_wheel_div").style.visibility="visible"})),new F("\n      012345\n      B66210\n      A58998\n      947109\n      8565BA\n      763400\n      ",new f(5,1),new f(5,5)),new F("\n    AAA\n    A8A\n    AAA\n    ",new f(1,0),new f(1,1)).set_message("Push x to pick up or drop a color orb.<div>You can also move to colors adjacent to your orb.</div>").add_orb(new f(1,2),9),new F("\n    77AA44\n    77AA44\n    ",new f(0,0),new f(5,1)).add_orb(new f(0,1),10).add_orb(new f(3,1),4).set_message("Orbs can create one-way doors."),new F("\n    888888888888888\n    8AAAAAAAAAAAAA8\n    8A00000000000A8\n    8A02222222220A8\n    8A02444444420A8\n    8A02466666420A8\n    8A0246...6420A8\n    8A0246...6420A8\n      ",new f(0,0),new f(100,100)).add_orb(new f(7,0),9).add_orb(new f(7,1),11).add_orb(new f(7,2),1).add_orb(new f(7,3),3).add_orb(new f(7,4),5).set_message("<h1>Thanks for playing!</h1>")];N.add_system(new D(V,document.getElementById("message"))),N.add_system(new k),N.add_system(new G),N.add_system(new S(Q.length)),N.add_system(new O),N.add_system(new B({canvas:document.getElementById("canvas"),tile_size:50,colors:Q})),N.add_system(new class extends u{constructor(e,t){super(),this.colors=e,this.canvas=t;let s=this.canvas.getContext("2d");if(null===s)throw new Error("Could not create rendering context");this.ctx=s,this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}tick(e,t){if(void 0===this.game)return;let s=this.game.get_system_or_die(S),i=s.get_adjacent_colors(s.get_player_colors());this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);let n=0;for(let e of this.colors){this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,this.canvas.height/2);let t=this.canvas.width/2;i.has(n)||(t*=.8),this.ctx.ellipse(this.canvas.width/2,this.canvas.height/2,t,t,0,2*(n-.5)*Math.PI/this.colors.length,2*(n+.5)*Math.PI/this.colors.length),this.ctx.fill(),n+=1}}}(Q,document.getElementById("color_wheel"))),N.get_system_or_die(D).set_level(0),N.tick(0),window.set_level=e=>N.get_system_or_die(D).set_level(e)})();